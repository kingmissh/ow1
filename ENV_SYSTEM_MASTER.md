# ğŸ—ï¸ Codespaces é…ç½®ç®¡ç†ä¸­å¿ƒåŒ–ä½“ç³»

> **æ ¸å¿ƒç†å¿µ**: é…ç½®ä¸­å¿ƒåŒ–ï¼Œåº”ç”¨é“¾æ¥åŒ–  
> **ç›®æ ‡**: é€šè¿‡ GitHub Codespaces çš„æŒä¹…åŒ–å±‚ï¼ˆLayer 1ï¼‰å¯¹æŠ—ç³»ç»Ÿå±‚ï¼ˆLayer 2ï¼‰çš„ä¸ç¡®å®šæ€§

---

## ğŸ“– æ–‡æ¡£å¯¼èˆª

- [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡) - ä¸‰å±‚æ•°æ®æ¨¡å‹ä¸ç›®å½•ç»“æ„
- [æ ¸å¿ƒè„šæœ¬](#æ ¸å¿ƒè„šæœ¬) - 2 ä¸ªæ ¸å¿ƒè„šæœ¬ + å¿«æ·å‘½ä»¤
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹) - é¦–æ¬¡é…ç½®æŒ‡å—
- [æ ‡å‡†æ“ä½œæµç¨‹](#æ ‡å‡†æ“ä½œæµç¨‹-sop) - 4 å¤§åœºæ™¯æ“ä½œæ‰‹å†Œ
- [è·¨è´¦å·è¿ç§»](#è·¨è´¦å·è¿ç§»æŒ‡å—) - å¤šè´¦å·/å›¢é˜Ÿåä½œæ–¹æ¡ˆ
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤) - å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

---

## æ¶æ„è®¾è®¡

### ä¸‰å±‚æ•°æ®æ¨¡å‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”´ Layer 3: ä¸´æ—¶å±‚ (Ephemeral)                                  â”‚
â”‚  /usr/bin, /etc/, /tmp/                                         â”‚
â”‚  â†’ éšå®¹å™¨é‡å»ºå®Œå…¨é‡ç½®                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸŸ¡ Layer 2: ç³»ç»Ÿå±‚ (System)                                     â”‚
â”‚  /home/codespace/.local/, ~/.npm/, ~/.cache/                    â”‚
â”‚  â†’ å¯é€‰æŒä¹…åŒ–ï¼Œå­˜åœ¨ä¸ç¡®å®šæ€§                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸŸ¢ Layer 1: æŒä¹…åŒ–å±‚ (Persistent)  â­ æ ¸å¿ƒèµ„äº§                  â”‚
â”‚  /workspaces/ow1/, /home/codespace/.config/                     â”‚
â”‚  â†’ ä¸ Git ä»“åº“åŒæ­¥ï¼Œå¯è·¨ç¯å¢ƒå¤åˆ»                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç›®å½•ç»“æ„

```
ow1/                                        # é¡¹ç›®ä»“åº“ï¼ˆLayer 1ï¼‰
â”œâ”€â”€ .config-store/                          # â­ é…ç½®ä¿é™©ç®±
â”‚   â”œâ”€â”€ openclaw/                          # â†’ é“¾æ¥åˆ° ~/.openclaw/
â”‚   â”œâ”€â”€ opencode/                          # â†’ é“¾æ¥åˆ° ~/.config/opencode/
â”‚   â”œâ”€â”€ git/                               # â†’ é“¾æ¥åˆ° ~/.config/git/
â”‚   â””â”€â”€ .gitignore                         # æ•æ„Ÿä¿¡æ¯æ’é™¤è§„åˆ™
â”œâ”€â”€ scripts/                               # ç¯å¢ƒç®¡ç†è„šæœ¬
â”‚   â”œâ”€â”€ add-tool.sh                   # å°†é…ç½®çº³å…¥ Git ç®¡ç†
â”‚   â”œâ”€â”€ init-links.sh                       # ä¸€é”®æ¢å¤ç¯å¢ƒ
â”‚   â”œâ”€â”€ save-config.sh                     # ä¿å­˜é…ç½®æ›´æ”¹
â”‚   â””â”€â”€ switch-env.sh                      # åˆ‡æ¢ç¯å¢ƒåˆ†æ”¯
â”œâ”€â”€ .devcontainer/
â”‚   â””â”€â”€ devcontainer.json                  # Codespaces é…ç½®
â””â”€â”€ CROSS_ACCOUNT_MIGRATION.md             # è·¨è´¦å·è¿ç§»æŒ‡å—ï¼ˆæœ¬æ–‡æ¡£ï¼‰
```

### è½¯é“¾æ¥å·¥ä½œåŸç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Git ä»“åº“ (.config-store/)                                   â”‚
â”‚  â”œâ”€ opencode/          â† é…ç½®æ–‡ä»¶å®é™…å­˜å‚¨ä½ç½®ï¼ˆLayer 1ï¼‰     â”‚
â”‚  â”œâ”€ openclaw/                                               â”‚
â”‚  â””â”€ .gitignore       â† æ’é™¤æ•æ„Ÿä¿¡æ¯                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ è½¯é“¾æ¥ (Symbolic Link)
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç³»ç»Ÿè·¯å¾„ (~/.config/opencode/)                              â”‚
â”‚  â†’ å®é™…æŒ‡å‘ .config-store/opencode/                         â”‚
â”‚  â†’ åº”ç”¨ç¨‹åºæ— æ„ŸçŸ¥ï¼Œå®æ—¶åŒæ­¥                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ ¸å¿ƒè„šæœ¬

### è„šæœ¬ A: add-tool.shï¼ˆçº³å…¥ç®¡ç†ï¼‰

**ç”¨é€”**: å°†ç°æœ‰é…ç½®ä» `~/.config/` ç§»åŠ¨åˆ° `.config-store/`ï¼Œå¹¶å»ºç«‹è½¯é“¾æ¥

```bash
#!/bin/bash
# add-tool.sh - å°†ç°æœ‰é…ç½®çº³å…¥ Git ç®¡ç†

set -e

# å®šä¹‰éœ€è¦ç®¡ç†çš„é…ç½®åˆ—è¡¨ (è·¯å¾„ç›¸å¯¹äº $HOME)
declare -A CONFIGS=(
    [".openclaw"]="openclaw"
    [".config/opencode"]="opencode"
    [".config/git"]="git"
)

REPO_ROOT=$(git rev-parse --show-toplevel 2>/dev/null || echo "/workspaces/ow1")
REPO_STORE="$REPO_ROOT/.config-store"
mkdir -p "$REPO_STORE"

echo "ğŸš€ å¼€å§‹çº³å…¥é…ç½®ç®¡ç†..."
echo ""

for source_path in "${!CONFIGS[@]}"; do
    store_name="${CONFIGS[$source_path]}"
    TARGET="$HOME/$source_path"
    STORE_PATH="$REPO_STORE/$store_name"

    if [ -e "$TARGET" ]; then
        if [ -L "$TARGET" ]; then
            echo "âš ï¸  $source_path å·²ç»æ˜¯è½¯é“¾æ¥ï¼Œè·³è¿‡"
            continue
        fi

        echo "ğŸ“¦ æ­£åœ¨å°† $source_path çº³å…¥ Git ç®¡ç†..."
        
        # å¤‡ä»½ç°æœ‰å­˜å‚¨
        if [ -e "$STORE_PATH" ]; then
            BACKUP="$STORE_PATH.backup.$(date +%s)"
            echo "   ğŸ“ å¤‡ä»½ç°æœ‰å­˜å‚¨åˆ° $BACKUP"
            mv "$STORE_PATH" "$BACKUP"
        fi

        # å¤åˆ¶åˆ°ä»“åº“ï¼ˆæ’é™¤æ•æ„Ÿç›®å½•ï¼‰
        mkdir -p "$STORE_PATH"
        rsync -av --progress \
            --exclude='credentials/' \
            --exclude='identity/' \
            --exclude='*.key' \
            --exclude='*.pem' \
            --exclude='.env' \
            "$TARGET/" "$STORE_PATH/"

        # åˆ é™¤åŸç›®å½•/æ–‡ä»¶å¹¶å»ºç«‹è½¯é“¾æ¥
        rm -rf "$TARGET"
        ln -s "$STORE_PATH" "$TARGET"
        
        echo "   âœ… $source_path â†’ $STORE_PATH"
        echo ""
    else
        echo "âš ï¸  $source_path ä¸å­˜åœ¨ï¼Œè·³è¿‡"
    fi
done

echo "ğŸ‰ é…ç½®çº³å…¥å®Œæˆï¼"
echo ""
echo "ğŸ“‹ ä¸‹ä¸€æ­¥:"
echo "   1. æ£€æŸ¥ .config-store/ å†…å®¹"
echo "   2. git add .config-store/"
echo "   3. git commit -m 'feat: add tool configurations'"
```

### è„šæœ¬ B: init-links.shï¼ˆä¸€é”®æ¢å¤ï¼‰

**ç”¨é€”**: ä» `.config-store/` æ¢å¤è½¯é“¾æ¥ï¼Œè‡ªåŠ¨æ³¨å…¥ Secrets

```bash
#!/bin/bash
# init-links.sh - ä¸€é”®æ¢å¤ç¯å¢ƒé…ç½®

set -e

REPO_ROOT=$(git rev-parse --show-toplevel 2>/dev/null || pwd)
REPO_STORE="$REPO_ROOT/.config-store"

# å®šä¹‰é…ç½®æ˜ å°„: å­˜å‚¨åç§° -> ç›®æ ‡è·¯å¾„
declare -A MAPPING=(
    ["openclaw"]="$HOME/.openclaw"
    ["opencode"]="$HOME/.config/opencode"
    ["git"]="$HOME/.config/git"
)

echo "ğŸš€ å¼€å§‹æ¢å¤ç¯å¢ƒé…ç½®..."
echo ""

# æ£€æŸ¥ä»“åº“ç›®å½•æ˜¯å¦å­˜åœ¨
if [ ! -d "$REPO_STORE" ]; then
    echo "âŒ é”™è¯¯: $REPO_STORE ä¸å­˜åœ¨"
    echo "   è¯·å…ˆè¿è¡Œ ./scripts/add-tool.sh çº³å…¥é…ç½®"
    exit 1
fi

for store_name in "${!MAPPING[@]}"; do
    STORE_PATH="$REPO_STORE/$store_name"
    TARGET="${MAPPING[$store_name]}"

    if [ -d "$STORE_PATH" ]; then
        echo "ğŸ”— æ­£åœ¨æ¢å¤ $store_name..."
        
        # ç¡®ä¿çˆ¶ç›®å½•å­˜åœ¨
        mkdir -p "$(dirname "$TARGET")"
        
        # å¦‚æœç›®æ ‡å·²å­˜åœ¨ä¸”ä¸æ˜¯é“¾æ¥ï¼Œå¤‡ä»½å®ƒ
        if [ -e "$TARGET" ] && [ ! -L "$TARGET" ]; then
            BACKUP="$TARGET.backup.$(date +%s)"
            echo "   ğŸ“ å¤‡ä»½åŸé…ç½®åˆ° $BACKUP"
            mv "$TARGET" "$BACKUP"
        fi
        
        # åˆ é™¤ç°æœ‰é“¾æ¥æˆ–ç›®å½•
        rm -rf "$TARGET"
        
        # å»ºç«‹è½¯é“¾æ¥
        ln -s "$STORE_PATH" "$TARGET"
        echo "   âœ… $TARGET â†’ $STORE_PATH"
    else
        echo "âš ï¸  $store_name ä¸å­˜åœ¨äºä»“åº“ä¸­ï¼Œè·³è¿‡"
    fi
done

# ğŸ” è‡ªåŠ¨æ³¨å…¥æ•æ„Ÿä¿¡æ¯ (åˆ©ç”¨ GitHub Secrets ç¯å¢ƒå˜é‡)
echo ""
echo "ğŸ” æ£€æŸ¥ Secrets æ³¨å…¥..."

if [ ! -z "$OPENCODE_API_KEY" ]; then
    mkdir -p "$HOME/.config/opencode"
    echo "{\"api_key\": \"$OPENCODE_API_KEY\"}" > "$HOME/.config/opencode/credentials.json"
    chmod 600 "$HOME/.config/opencode/credentials.json"
    echo "   âœ… OpenCode API å¯†é’¥å·²æ³¨å…¥"
fi

if [ ! -z "$OPENCLAW_API_KEY" ]; then
    mkdir -p "$HOME/.openclaw/credentials"
    echo "{\"api_key\": \"$OPENCLAW_API_KEY\"}" > "$HOME/.openclaw/credentials/openclaw.json"
    chmod 600 "$HOME/.openclaw/credentials/openclaw.json"
    echo "   âœ… OpenClaw API å¯†é’¥å·²æ³¨å…¥"
fi

echo ""
echo "ğŸ‰ ç¯å¢ƒæ¢å¤å®Œæˆï¼"
echo ""
echo "ğŸ“‹ ä¸‹ä¸€æ­¥:"
echo "   â€¢ è¿è¡Œ 'opencode auth login' éªŒè¯æˆæƒï¼ˆå¦‚éœ€è¦ï¼‰"
echo "   â€¢ æ£€æŸ¥å·¥å…·é…ç½®æ˜¯å¦ç”Ÿæ•ˆ"
```

### å¿«æ·å‘½ä»¤: save-commit (ä¿å­˜)ï¼ˆä¿å­˜æ›´æ”¹ï¼‰

**ç”¨é€”**: ä¿å­˜ `.config-store/` çš„æ›´æ”¹åˆ° Git

```bash
#!/bin/bash
# save-config.sh - ä¿å­˜å½“å‰é…ç½®æ›´æ”¹åˆ° Git

set -e

cd "$(git rev-parse --show-toplevel 2>/dev/null || echo /workspaces/ow1)"

# è‡ªåŠ¨ç”Ÿæˆæäº¤ä¿¡æ¯
if [ -z "$1" ]; then
    MSG="chore: update configs ($(date '+%Y-%m-%d %H:%M'))"
else
    MSG="$1"
fi

echo "ğŸ’¾ ä¿å­˜é…ç½®æ›´æ”¹..."
echo ""

# æ£€æŸ¥æ˜¯å¦æœ‰æ›´æ”¹
if [ -z "$(git status --porcelain .config-store/ 2>/dev/null)" ]; then
    echo "âœ¨ .config-store/ æ²¡æœ‰æ›´æ”¹"
else
    echo "ğŸ“¦ å‘ç°ä»¥ä¸‹æ›´æ”¹:"
    git status --short .config-store/
    echo ""
    
    git add .config-store/
    git commit -m "$MSG"
    echo ""
    echo "âœ… å·²æäº¤: $MSG"
fi

echo ""
read -p "ğŸ“¤ æ¨é€åˆ°è¿œç¨‹? (y/n): " push

if [[ $push =~ ^[Yy]$ ]]; then
    git push
    echo "âœ… å·²æ¨é€ï¼"
else
    echo "â¸ï¸  å·²ä¿å­˜ä½†æœªæ¨é€ï¼Œç¨åè¿è¡Œ: git push"
fi
```

### å¿«æ·å‘½ä»¤: reset-config (å›æ»š)ï¼ˆç¯å¢ƒåˆ‡æ¢ï¼‰

**ç”¨é€”**: åˆ‡æ¢ Git åˆ†æ”¯å¹¶æ¢å¤å¯¹åº”é…ç½®

```bash
#!/bin/bash
# switch-env.sh - åˆ‡æ¢ç¯å¢ƒé…ç½®ï¼ˆä½¿ç”¨ Git åˆ†æ”¯ï¼‰

set -e

if [ -z "$1" ]; then
    echo "âŒ ç”¨æ³•: ./scripts/switch-env.sh <åˆ†æ”¯å>"
    echo ""
    echo "å½“å‰åˆ†æ”¯: $(git branch --show-current)"
    echo ""
    echo "å¯ç”¨ç¯å¢ƒåˆ†æ”¯:"
    git branch -a | grep "env/" || echo "   (æ— ç¯å¢ƒåˆ†æ”¯)"
    echo ""
    echo "å¿«é€Ÿåˆ›å»ºç¯å¢ƒåˆ†æ”¯:"
    echo "   git checkout -b env/<name>"
    exit 1
fi

BRANCH="$1"

echo "ğŸ”„ åˆ‡æ¢åˆ°ç¯å¢ƒ: $BRANCH"
echo ""

# æ£€æŸ¥åˆ†æ”¯æ˜¯å¦å­˜åœ¨
if ! git show-ref --verify --quiet "refs/heads/$BRANCH"; then
    echo "âŒ æœ¬åœ°åˆ†æ”¯ $BRANCH ä¸å­˜åœ¨"
    echo ""
    read -p "æ˜¯å¦åˆ›å»ºæ–°åˆ†æ”¯? (y/n): " create
    if [[ $create =~ ^[Yy]$ ]]; then
        git checkout -b "$BRANCH"
        echo "âœ… å·²åˆ›å»ºå¹¶åˆ‡æ¢åˆ° $BRANCH"
    else
        exit 1
    fi
else
    # åˆ‡æ¢åˆ†æ”¯
    git checkout "$BRANCH"
fi

# é‡æ–°å»ºç«‹é“¾æ¥ï¼ˆå› ä¸ºåˆ‡æ¢åˆ†æ”¯å¯èƒ½æ”¹å˜äº† .config-store å†…å®¹ï¼‰
echo ""
echo "ğŸ”— é‡æ–°å»ºç«‹é…ç½®é“¾æ¥..."
"$(dirname "$0")/init-links.sh"

echo ""
echo "âœ… å·²åˆ‡æ¢åˆ° $BRANCH ç¯å¢ƒ"
```

### .gitignore å®‰å…¨è¿‡æ»¤

```
# æ•æ„Ÿä¿¡æ¯ï¼ˆæ°¸ä¸æäº¤ï¼‰
.config-store/**/credentials/
.config-store/**/identity/
.config-store/**/*.key
.config-store/**/*.pem
.config-store/**/.env
.config-store/**/secrets*

# ä¸´æ—¶æ–‡ä»¶
*.backup.*
*.tmp
*.log
.DS_Store

# ä¸éœ€è¦ç‰ˆæœ¬åŒ–çš„ç¼“å­˜
.config-store/**/cache/
.config-store/**/node_modules/
.config-store/**/.cache/

# ç”¨æˆ·ç‰¹å®šé…ç½®ï¼ˆå¯é€‰ï¼‰
.config-store/**/history
.config-store/**/local/
```

---

## å¿«é€Ÿå¼€å§‹

### é¦–æ¬¡é…ç½®ï¼ˆå•è´¦å·ï¼‰

```bash
# 1. å…‹éš†ä»“åº“ï¼ˆå¦‚æœå°šæœªå…‹éš†ï¼‰
git clone https://github.com/yourname/ow1.git
cd ow1

# 2. å®‰è£…å¹¶é…ç½®ä½ çš„å·¥å…·
npm install -g opencode
opencode auth login  # å®Œæˆåˆå§‹é…ç½®

# 3. å°†é…ç½®çº³å…¥ Git ç®¡ç†
./scripts/add-tool.sh

# 4. æäº¤é…ç½®
./scripts/save-config.sh "feat: init opencode config"

# 5. æ¨é€åˆ°è¿œç¨‹
git push
```

### é‡å»ºç¯å¢ƒï¼ˆé‡å»º Codespaceï¼‰

```bash
# è‡ªåŠ¨æ‰§è¡Œï¼ˆå·²é€šè¿‡ devcontainer.json é…ç½®ï¼‰
./scripts/init-links.sh

# éªŒè¯
ls -la ~/.config/opencode  # åº”è¯¥æ˜¯è½¯é“¾æ¥
opencode --version         # æµ‹è¯•å·¥å…·
```

---

## æ ‡å‡†æ“ä½œæµç¨‹ (SOP)

### åœºæ™¯ 1: å®‰è£…æ–°å·¥å…·å¹¶ä¿å­˜

```bash
# å®‰è£…å·¥å…·å¹¶é…ç½®
npm install -g some-tool
some-tool configure

# æ›´æ–°é…ç½®åˆ—è¡¨ï¼ˆç¼–è¾‘ add-tool.shï¼‰
# declare -A CONFIGS=(
#     ...
#     [".config/some-tool"]="some-tool"
# )

# çº³å…¥ç®¡ç†å¹¶ä¿å­˜
./scripts/add-tool.sh
./scripts/save-config.sh "feat: add some-tool config"
```

### åœºæ™¯ 2: å®éªŒå¤±è´¥ï¼Œå›é€€é‡æ¥

```bash
# æ–¹æ³• A: Git å›é€€ï¼ˆæ¨èï¼‰
git checkout .config-store/  # é…ç½®æ–‡ä»¶ç«‹å³æ¢å¤

# æ–¹æ³• B: åˆ‡æ¢åˆ†æ”¯å›åˆ°ç¨³å®šç‰ˆæœ¬
./scripts/switch-env.sh main

# æ–¹æ³• C: å®Œå…¨é‡å»ºï¼ˆç»ˆææ–¹æ¡ˆï¼‰
# 1. åœ¨ Codespaces é¢æ¿ç‚¹å‡» "Rebuild Container"
# 2. é‡å¯åè‡ªåŠ¨è¿è¡Œ init-links.sh
```

### åœºæ™¯ 3: å¤šç¯å¢ƒæµ‹è¯•ï¼ˆGPT-4 vs Claudeï¼‰

```bash
# åˆ›å»º Claude ç¯å¢ƒ
git checkout -b env/claude
# ä¿®æ”¹ .config-store/opencode/settings.json
./scripts/save-config.sh "env: configure for Claude"

# åˆ›å»º GPT-4 ç¯å¢ƒ
git checkout -b env/gpt4
# ä¿®æ”¹é…ç½®
./scripts/save-config.sh "env: configure for GPT-4"

# å¿«é€Ÿåˆ‡æ¢ç¯å¢ƒ
./scripts/switch-env.sh env/claude
./scripts/switch-env.sh env/gpt4
```

### åœºæ™¯ 4: æ—¥å¸¸ä½¿ç”¨ - ä¿®æ”¹å¹¶ä¿å­˜é…ç½®

```bash
# ä¿®æ”¹é…ç½®ï¼ˆå¦‚é€šè¿‡ opencode ç•Œé¢ï¼‰
opencode

# ä¿å­˜æ›´æ”¹
./scripts/save-config.sh

# æ¨é€åˆ°è¿œç¨‹ï¼ˆå¯é€‰ï¼‰
git push
```

---

## è·¨è´¦å·è¿ç§»æŒ‡å—

### æ¦‚è¿°

è·¨è´¦å·è¿ç§»çš„æ ¸å¿ƒæ˜¯**"é…ç½®èµ„äº§è¿ç§»"**å’Œ**"ç¯å¢ƒé‡æ–°æˆæƒ"**ã€‚æ•æ„Ÿä¿¡æ¯ï¼ˆSecretsï¼‰ä¸ä¼šéšä»“åº“è‡ªåŠ¨è¿ç§»ï¼Œéœ€è¦åœ¨æ–°è´¦å·ä¸­æ‰‹åŠ¨é…ç½®ã€‚

### ç¬¬ä¸€é˜¶æ®µï¼šè¿ç§»ä¸­å¿ƒé…ç½®ä»“åº“

#### æ–¹å¼ A: é‚€è¯·åä½œï¼ˆæœ€å¿«ï¼Œé€‚åˆå›¢é˜Ÿï¼‰

1. åœ¨åŸè´¦å·çš„ `config-repo` ä»“åº“è®¾ç½®ä¸­ï¼Œå°†æ–°è´¦å·æ·»åŠ ä¸º **Collaborator**
2. æ–°è´¦å·æ¥å—é‚€è¯·åå³å¯è®¿é—®

#### æ–¹å¼ B: ä»“åº“å…‹éš†ä¸é‡æ–°ä¸Šä¼ ï¼ˆæ¨èï¼Œé€‚åˆä¸ªäººï¼‰

```bash
# 1. åœ¨åŸè´¦å·ä¸­å…‹éš†ä»“åº“åˆ°æœ¬åœ°
git clone https://github.com/old-account/config-repo.git
cd config-repo

# 2. æ·»åŠ æ–°è´¦å·çš„è¿œç¨‹ä»“åº“
git remote add new-origin https://github.com/new-account/config-repo.git

# 3. æ¨é€åˆ°æ–°è´¦å·
# æ³¨æ„ï¼šç”±äº .gitignore é…ç½®ï¼Œæ•æ„Ÿä¿¡æ¯ä¸ä¼šè¢«æ¨é€
git push new-origin main

# æˆ–è€…åœ¨æ–°è´¦å·é‡æ–°åˆ›å»ºä»“åº“
# 1. åœ¨ GitHub æ–°è´¦å·åˆ›å»ºç©ºçš„ç§æœ‰ä»“åº“ config-repo
# 2. git remote set-url origin https://github.com/new-account/config-repo.git
# 3. git push -u origin main
```

### ç¬¬äºŒé˜¶æ®µï¼šåœ¨æ–°è´¦å·é…ç½® Secrets

GitHub Secrets æ˜¯ç»‘å®šåœ¨è´¦å·æˆ–ä»“åº“çº§åˆ«çš„ï¼Œå¿…é¡»é‡æ–°é…ç½®ã€‚

#### é…ç½®æ­¥éª¤

1. **ç™»å½•æ–°è´¦å·**ï¼Œè¿›å…¥ GitHub ä¸»é¡µ
2. **è®¿é—® Secrets è®¾ç½®**:
   - **Codespaces çº§åˆ«**: `Settings` â†’ `Codespaces` â†’ `Secrets`
   - **ä»“åº“çº§åˆ«**: è¿›å…¥å…·ä½“ä»“åº“ â†’ `Settings` â†’ `Secrets and variables` â†’ `Codespaces`

3. **æ·»åŠ  Secrets**:

| Secret åç§° | ç”¨é€” | ç¤ºä¾‹å€¼ |
|------------|------|--------|
| `OPENCODE_API_KEY` | OpenCode API å¯†é’¥ | `sk-...` |
| `OPENCLAW_API_KEY` | OpenClaw API å¯†é’¥ | `oc-...` |
| `GITHUB_TOKEN` | GitHub è®¿é—®ä»¤ç‰Œ | `ghp_...` |

4. **è®¾ç½®è®¿é—®èŒƒå›´**: ç¡®ä¿ Secret çš„è®¿é—®æƒé™åŒ…å«æ‰€æœ‰éœ€è¦ä½¿ç”¨è¯¥å¯†é’¥çš„ä»“åº“

### ç¬¬ä¸‰é˜¶æ®µï¼šåœ¨æ–°é¡¹ç›®ä¸­ä½¿ç”¨

#### æ–¹å¼ A: ç›´æ¥å…‹éš†ï¼ˆå•é¡¹ç›®ï¼‰

```bash
# 1. åœ¨æ–°è´¦å·ä¸‹å…‹éš†é…ç½®ä»“åº“
git clone https://github.com/new-account/config-repo.git
cd config-repo

# 2. è¿è¡Œæ¢å¤è„šæœ¬
./scripts/init-links.sh

# 3. éªŒè¯æ•æ„Ÿä¿¡æ¯æ³¨å…¥
ls -la ~/.config/opencode/credentials.json  # åº”å­˜åœ¨ä¸”ç”± Secrets æ³¨å…¥
```

#### æ–¹å¼ B: å­æ¨¡å—æ¨¡å¼ï¼ˆå¤šé¡¹ç›®å¤ç”¨ï¼Œæ¨èï¼‰

```bash
# 1. åœ¨æ–°é¡¹ç›®ä¸­æ·»åŠ é…ç½®ä¸­å¿ƒä¸ºå­æ¨¡å—
cd /workspaces/new-project
git submodule add https://github.com/new-account/config-repo.git .dev-ops
git submodule update --init --recursive

# 2. è¿è¡Œè®¾ç½®è„šæœ¬
bash .dev-ops/scripts/init-links.sh

# 3. é…ç½®è‡ªåŠ¨åŒ–ï¼ˆdevcontainer.jsonï¼‰
# åœ¨ .devcontainer/devcontainer.json ä¸­æ·»åŠ :
{
  "postCreateCommand": "git submodule update --init --recursive && bash .dev-ops/scripts/init-links.sh",
  "remoteEnv": {
    "OPENCODE_API_KEY": "${secrets.OPENCODE_API_KEY}",
    "OPENCLAW_API_KEY": "${secrets.OPENCLAW_API_KEY}"
  }
}
```

#### æ–¹å¼ C: ä¸€é”®å¤åˆ»è„šæœ¬

åˆ›å»º `migrate-to-new-account.sh`:

```bash
#!/bin/bash
# migrate-to-new-account.sh - ä¸€é”®å¤åˆ»åˆ°æ–°è´¦å·

set -e

echo "ğŸš€ å¼€å§‹è¿ç§»åˆ°æ–°è´¦å·..."
echo ""

# æ£€æŸ¥å¿…è¦çš„ç¯å¢ƒå˜é‡
if [ -z "$NEW_GITHUB_USERNAME" ] || [ -z "$NEW_REPO_NAME" ]; then
    echo "âŒ é”™è¯¯: è¯·è®¾ç½®ç¯å¢ƒå˜é‡"
    echo "   export NEW_GITHUB_USERNAME='your-new-username'"
    echo "   export NEW_REPO_NAME='config-repo'"
    exit 1
fi

NEW_REPO_URL="https://github.com/$NEW_GITHUB_USERNAME/$NEW_REPO_NAME.git"

echo "ğŸ“¦ æ­¥éª¤ 1/4: æ£€æŸ¥å½“å‰ä»“åº“..."
cd "$(git rev-parse --show-toplevel)"
git status

echo ""
echo "ğŸ“¤ æ­¥éª¤ 2/4: æ¨é€åˆ°æ–°è´¦å·..."
git remote add new-account "$NEW_REPO_URL" 2>/dev/null || echo "è¿œç¨‹ä»“åº“å·²å­˜åœ¨"
git push new-account main

echo ""
echo "ğŸ” æ­¥éª¤ 3/4: éªŒè¯ Secrets é…ç½®..."
echo "âš ï¸  è¯·æ‰‹åŠ¨æ£€æŸ¥ä»¥ä¸‹ Secrets æ˜¯å¦å·²åœ¨æ–°è´¦å·é…ç½®:"
echo "   â€¢ OPENCODE_API_KEY"
echo "   â€¢ OPENCLAW_API_KEY"
read -p "å·²å®Œæˆé…ç½®? (y/n): " confirmed

if [[ ! $confirmed =~ ^[Yy]$ ]]; then
    echo "â¸ï¸  è¿ç§»æš‚åœï¼Œè¯·åœ¨é…ç½®å®Œæˆåé‡æ–°è¿è¡Œè„šæœ¬"
    exit 0
fi

echo ""
echo "âœ… æ­¥éª¤ 4/4: éªŒè¯è¿ç§»..."
echo "   æ–°ä»“åº“åœ°å€: $NEW_REPO_URL"
echo ""
echo "ğŸ“‹ è¿ç§»å®Œæˆåçš„æ£€æŸ¥æ¸…å•:"
echo "   â–¡ åœ¨æ–° Codespace å…‹éš†ä»“åº“"
echo "   â–¡ è¿è¡Œ ./scripts/init-links.sh"
echo "   â–¡ éªŒè¯å·¥å…·é…ç½®"
echo "   â–¡ æµ‹è¯• API è°ƒç”¨"
echo ""
echo "ğŸ‰ è¿ç§»å®Œæˆï¼"
```

### ç¬¬å››é˜¶æ®µï¼šéªŒè¯ä¸æµ‹è¯•

```bash
# 1. éªŒè¯é“¾æ¥
ls -la ~/.config/opencode
# é¢„æœŸè¾“å‡º: ~/.config/opencode -> /workspaces/.../.config-store/opencode

# 2. éªŒè¯ Secrets æ³¨å…¥
cat ~/.config/opencode/credentials.json
# é¢„æœŸè¾“å‡ºåŒ…å«ä» Secrets æ³¨å…¥çš„ API Key

# 3. æµ‹è¯•å·¥å…·
opencode --version
opencode list  # æˆ–ä»»æ„éœ€è¦æˆæƒçš„å‘½ä»¤

# 4. éªŒè¯ Git é…ç½®
git config --global user.name
git config --global user.email
```

### ç¬¬äº”é˜¶æ®µï¼šå¤šè´¦å·åŒæ­¥ç­–ç•¥

å¦‚æœä½ æœ‰å¤šä¸ª GitHub è´¦å·ï¼ˆå¦‚ä¸ªäºº + å…¬å¸ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç­–ç•¥ï¼š

#### ç­–ç•¥ A: ä¸»ä»åŒæ­¥

```bash
# åœ¨ä¸ªäººè´¦å·ä½œä¸ºä¸»ä»“åº“
# å…¬å¸è´¦å·å®šæœŸæ‹‰å–æ›´æ–°

# å…¬å¸è´¦å·æ“ä½œ
git remote add personal https://github.com/personal-account/config-repo.git
git fetch personal
git merge personal/main  # åˆå¹¶ä¸ªäººè´¦å·çš„æ›´æ–°
```

#### ç­–ç•¥ B: åˆ†æ”¯éš”ç¦»

```bash
# åœ¨é…ç½®ä»“åº“ä¸­åˆ›å»ºè´¦å·ä¸“ç”¨åˆ†æ”¯

# ä¸ªäººè´¦å·åˆ†æ”¯
git checkout -b account/personal
# é…ç½®ä¸ªäººä¸“å±è®¾ç½®
./scripts/save-config.sh "account: personal settings"

# å…¬å¸è´¦å·åˆ†æ”¯
git checkout -b account/company
# é…ç½®å…¬å¸ä¸“å±è®¾ç½®
./scripts/save-config.sh "account: company settings"

# åˆ‡æ¢è´¦å·ç¯å¢ƒ
./scripts/switch-env.sh account/personal
./scripts/switch-env.sh account/company
```

#### ç­–ç•¥ C: ç‹¬ç«‹ä»“åº“ + å…±äº«æ¨¡æ¿

```bash
# 1. åˆ›å»ºä¸€ä¸ªå…¬å¼€çš„æ¨¡æ¿ä»“åº“ï¼ˆä¸å«æ•æ„Ÿä¿¡æ¯ï¼‰
# config-repo-template/  # å…¬å¼€
#   â”œâ”€â”€ scripts/
#   â”œâ”€â”€ .gitignore
#   â””â”€â”€ README.md

# 2. æ¯ä¸ªè´¦å· fork æˆ–å¤åˆ¶æ¨¡æ¿
git clone https://github.com/template/config-repo-template.git config-repo
cd config-repo

# 3. æ·»åŠ è‡ªå·±çš„é…ç½®
./scripts/add-tool.sh
./scripts/save-config.sh "init: personal config"

# 4. æ¨é€åˆ°è‡ªå·±çš„ç§æœ‰ä»“åº“
git remote set-url origin https://github.com/my-account/config-repo.git
git push -u origin main
```

---

## æ•…éšœæ’é™¤

### é—®é¢˜ 1: è½¯é“¾æ¥å¤±æ•ˆ

**ç—‡çŠ¶**: æç¤º "No such file or directory"

**è§£å†³æ–¹æ¡ˆ**:
```bash
# é‡æ–°å»ºç«‹é“¾æ¥
./scripts/init-links.sh

# å¦‚æœé“¾æ¥æŒ‡å‘é”™è¯¯è·¯å¾„ï¼Œå…ˆåˆ é™¤å†é‡å»º
rm -rf ~/.config/opencode
./scripts/init-links.sh
```

### é—®é¢˜ 2: Secrets æœªæ³¨å…¥

**ç—‡çŠ¶**: å·¥å…·æç¤ºéœ€è¦ç™»å½•æˆ– API Key æ— æ•ˆ

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. æ£€æŸ¥ç¯å¢ƒå˜é‡
echo $OPENCODE_API_KEY

# 2. æ‰‹åŠ¨æ³¨å…¥ï¼ˆä¸´æ—¶æ–¹æ¡ˆï¼‰
mkdir -p ~/.config/opencode
echo '{"api_key": "your-key-here"}' > ~/.config/opencode/credentials.json

# 3. æ£€æŸ¥ Secrets é…ç½®ï¼ˆæ°¸ä¹…æ–¹æ¡ˆï¼‰
# å‰å¾€ GitHub Settings -> Codespaces -> Secrets é‡æ–°é…ç½®
```

### é—®é¢˜ 3: Git æäº¤åŒ…å«æ•æ„Ÿä¿¡æ¯

**ç—‡çŠ¶**: ä¸å°å¿ƒæäº¤äº† credentials/

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. ä» Git å†å²ä¸­ç§»é™¤ï¼ˆè°¨æ…æ“ä½œï¼‰
git filter-branch --force --index-filter \
  'git rm --cached --ignore-unmatch -r .config-store/*/credentials/' \
  --prune-empty --tag-name-filter cat -- --all

# 2. å¼ºåˆ¶æ¨é€ï¼ˆä¼šé‡å†™å†å²ï¼ï¼‰
git push origin --force --all

# 3. æ›´æ–° .gitignore é˜²æ­¢å†æ¬¡å‘ç”Ÿ
echo ".config-store/**/credentials/" >> .gitignore
```

### é—®é¢˜ 4: é…ç½®å†²çª

**ç—‡çŠ¶**: ä¸åŒåˆ†æ”¯çš„é…ç½®äº’ç›¸è¦†ç›–

**è§£å†³æ–¹æ¡ˆ**:
```bash
# å¤‡ä»½å½“å‰é…ç½®
mv ~/.openclaw ~/.openclaw.backup.$(date +%s)

# é‡æ–°å»ºç«‹é“¾æ¥
./scripts/init-links.sh

# æˆ–ä½¿ç”¨ stow æ¨¡å¼ç®¡ç†å¤šç‰ˆæœ¬ï¼ˆé«˜çº§ï¼‰
```

---

## æœ€ä½³å®è·µæ€»ç»“

### æ—¥å¸¸æ“ä½œæ¸…å•

| æ“ä½œ | å‘½ä»¤ | é¢‘ç‡ |
|------|------|------|
| ä¿®æ”¹é…ç½® | æ­£å¸¸ä½¿ç”¨å·¥å…· | æ¯å¤© |
| ä¿å­˜é…ç½® | `./scripts/save-config.sh` | æ¯æ¬¡ä¿®æ”¹å |
| æ¨é€è¿œç¨‹ | `git push` | æ¯å¤©/æ¯å‘¨ |
| åˆ›å»ºç¯å¢ƒ | `./scripts/switch-env.sh env/name` | æŒ‰éœ€ |
| é‡å»ºç¯å¢ƒ | `./scripts/init-links.sh` | é‡å»ºå |

### å®‰å…¨æ¸…å•

- [x] `.gitignore` å·²æ’é™¤ `credentials/`, `identity/`, `*.key`
- [x] Secrets å­˜å‚¨åœ¨ GitHub Codespaces Secrets ä¸­
- [x] API Key æ–‡ä»¶æƒé™è®¾ç½®ä¸º 600 (`chmod 600`)
- [x] å®šæœŸå®¡æŸ¥ Git å†å²ç¡®ä¿æ— æ•æ„Ÿä¿¡æ¯æ³„æ¼
- [x] ä½¿ç”¨ä¸ªäººè®¿é—®ä»¤ç‰Œè€Œéå¯†ç 

### æ€§èƒ½ä¼˜åŒ–

```bash
# ä½¿ç”¨ --depth=1 å…‹éš†å­æ¨¡å—ï¼ˆèŠ‚çœç©ºé—´ï¼‰
git submodule add --depth=1 https://github.com/... .dev-ops

# å®šæœŸæ¸…ç†å¤‡ä»½æ–‡ä»¶
find .config-store -name "*.backup.*" -mtime +30 -delete
```

---

## é™„å½•

### A. å®Œæ•´ devcontainer.json æ¨¡æ¿

```json
{
  "name": "Config-Centric Workspace",
  "image": "mcr.microsoft.com/devcontainers/universal:2",
  
  "features": {
    "ghcr.io/devcontainers/features/github-cli:1": {},
    "ghcr.io/devcontainers/features/node:1": {
      "version": "lts"
    }
  },
  
  "postCreateCommand": "bash scripts/init-links.sh",
  
  "postStartCommand": "echo 'âœ… ç¯å¢ƒå·²æ¢å¤ã€‚å¦‚éœ€é…ç½® API Keyï¼Œæ£€æŸ¥ GitHub Secrets è®¾ç½®'",
  
  "customizations": {
    "vscode": {
      "extensions": [
        "GitHub.copilot",
        "eamodio.gitlens",
        "ms-vscode.vscode-json"
      ],
      "settings": {
        "git.enableSmartCommit": true,
        "git.confirmSync": false,
        "terminal.integrated.defaultProfile.linux": "bash"
      }
    }
  },
  
  "remoteEnv": {
    "OPENCODE_API_KEY": "${secrets.OPENCODE_API_KEY}",
    "OPENCLAW_API_KEY": "${secrets.OPENCLAW_API_KEY}",
    "CONFIG_STORE": "${containerWorkspaceFolder}/.config-store"
  },
  
  "mounts": [
    "source=${localEnv:HOME}/.ssh,target=/home/codespace/.ssh,type=bind,consistency=cached"
  ]
}
```

### B. å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

```bash
# é…ç½®ç®¡ç†
./scripts/add-tool.sh      # çº³å…¥ç®¡ç†
./scripts/init-links.sh          # æ¢å¤ç¯å¢ƒ
./scripts/save-config.sh        # ä¿å­˜æ›´æ”¹
./scripts/switch-env.sh <branch> # åˆ‡æ¢ç¯å¢ƒ

# Git æ“ä½œ
git add .config-store/
git commit -m "feat: update configs"
git push

# è½¯é“¾æ¥æ£€æŸ¥
ls -la ~/.config/opencode       # æŸ¥çœ‹é“¾æ¥
readlink ~/.config/opencode     # æŸ¥çœ‹ç›®æ ‡

# Secrets è°ƒè¯•
echo $OPENCODE_API_KEY          # æ£€æŸ¥å˜é‡
env | grep API_KEY              # åˆ—å‡ºæ‰€æœ‰ Key
```

### C. èµ„æºé“¾æ¥

- [GitHub Codespaces æ–‡æ¡£](https://docs.github.com/codespaces)
- [Git å­æ¨¡å—æŒ‡å—](https://git-scm.com/book/en/v2/Git-Tools-Submodules)
- [GitHub Secrets æ–‡æ¡£](https://docs.github.com/codespaces/managing-your-codespaces/managing-encrypted-secrets-for-your-codespaces)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2026-02-10  
**ä½œè€…**: GitHub Copilot + OpenCode
